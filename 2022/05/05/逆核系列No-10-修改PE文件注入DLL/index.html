<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="逆核系列No.10--修改PE文件注入DLL"><meta name="keywords" content="《逆向工程核心原理学习》,逆向"><meta name="author" content="Victory+"><meta name="copyright" content="Victory+"><title>逆核系列No.10--修改PE文件注入DLL | Victory+'s blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.2.0'
} </script><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Victory+'s blog" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="当前文章概览">站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E8%8A%82%E5%86%85%E5%AE%B9"><span class="toc-number">1.</span> <span class="toc-text">本节内容</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IMPORT-TABLE"><span class="toc-number">1.1.</span> <span class="toc-text">IMPORT TABLE</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80"><span class="toc-number">2.</span> <span class="toc-text">方案一</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6%E7%A9%BA%E7%99%BD%E5%8C%BA%E5%9F%9F"><span class="toc-number">2.1.</span> <span class="toc-text">查找文件空白区域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E6%96%B0%E7%9A%84-IMAGE-IMPORT-DESCRIPTOR"><span class="toc-number">2.2.</span> <span class="toc-text">构建新的_IMAGE_IMPORT_DESCRIPTOR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E8%8A%82%E5%8C%BA%E7%9A%84%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98"><span class="toc-number">2.3.</span> <span class="toc-text">写入节区的权限问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E6%96%B0%E7%9A%84IDT"><span class="toc-number">2.4.</span> <span class="toc-text">写入新的IDT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E5%88%AB%E6%B3%A8%E6%84%8F"><span class="toc-number">2.5.</span> <span class="toc-text">特别注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%AA%8C%E8%AF%81"><span class="toc-number">3.</span> <span class="toc-text">修改验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E9%A1%BE"><span class="toc-number">4.</span> <span class="toc-text">回顾</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Victory+</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">25</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">4</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">2</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友链(欢迎扩列哟...)</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://github.com/lcatro">lcatro</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://w.wallhaven.cc/full/x8/wallhaven-x8gkpo.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Victory+'s blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives/">Archives</a><a class="site-page" href="/tags/">Tags</a><a class="site-page" href="/categories/">Categories</a><a class="site-page" href="/todolist/">ToDoList</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">逆核系列No.10--修改PE文件注入DLL</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-05-05</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E9%80%86%E5%90%91/">-逆向</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2022/05/05/逆核系列No-10-修改PE文件注入DLL/"></span></a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">2.4k</span><span class="post-meta__separator">|</span><span>Reading time: 9 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h3 id="本节内容"><a href="#本节内容" class="headerlink" title="本节内容"></a>本节内容</h3><p>通过修改PE相应内容达到加载DLL的功能，参考书《逆向工程核心原理》</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/PE.JPG" class="">

<hr>
<h4 id="IMPORT-TABLE"><a href="#IMPORT-TABLE" class="headerlink" title="IMPORT TABLE"></a>IMPORT TABLE</h4><p>通过先前PE格式的相关学习，了解到PE文件中的IMPORT TABLE记录着载入的模块以及相应的导入函数信息</p>
<p>IMPORT TABLE导入表的起始地址位于PE格式中的OptionalHeader.DataDirectory[16]中第二个元素，使用PE-view查看：</p>
<p>（PS：建议还不熟悉PE格式的手动进行字段值的查找练习）</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/1.png" class="">

<p>读取出来的IMPORT TABLE的RVA &#x3D; 0x000084CC，结合各个节区头信息：</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/2.png" class="">

<p>因此0x000084CC位于节区.rdata，转换成RAW：<code>0x000084CC-0x00006000+0x00005200 = 0x000076CC</code>HxD下跟随到该地址：</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/3.png" class="">

<p>选中蓝色背景是第一个IMAGE_IMPORT_DESCRIPTOR结构体，往后每一个颜色的框都是一个IMAGE_IMPORT_DESCRIPTOR结构体，最后以黄色全NULL标志结束，因此示例程序导入的dll有4个，使用软件验证：</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/4.png" class="">



<p>本节通过修改PE文件里的内容达到载入DLL的目的，因此思路就有了：往文件偏移地址0x000076CC的末尾，黄色框处填补要导入的dll构造对应的_IMAGE_IMPORT_DESCRIPTOR结构体，这里人就需要一个全null的_IMAGE_IMPORT_DESCRIPTOR结构体结尾保持PE格式的完成，显然强行操作会覆盖到后续的内容（这可能导致PE文件无法正常的运行）</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/3.png" class="">

<p>因此需要考虑将块内容进行搬迁。将搬迁后的IDT地址以及size写回Optionalheader.datadirector[1]。搬迁方案有三：</p>
<ul>
<li>查找文件空白区域</li>
<li>增加文件最后一个节区的大小</li>
<li>在文件末尾添加新节区</li>
</ul>
<h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><h4 id="查找文件空白区域"><a href="#查找文件空白区域" class="headerlink" title="查找文件空白区域"></a>查找文件空白区域</h4><p>利用PE文件映射到内存中由于对齐产生的NULL区域，先查看对齐的相关：IMAGE_OPTIONAL_HEADER.SectionAlignment &amp; FileAlignment:</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/5.png" class="">

<p>SectionAlignment &#x3D; 0x00001000  FIleAlignment &#x3D; 0x00000200，结合节区头信息：</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/2.png" class="">

<p>画出.text 和 .rdata映射示意图：</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/6.png" class="">

<p>由于节区载入内存的对其关系，使得.text .rdata节区都有200字节的null空白区域</p>
<p>节区.text空白区域地址转化的结果：   0x5C7C -&gt; <strong>0x507C ～0x5200</strong></p>
<p>节区.rdata空白区域地址转化的结果：0x8C56 -&gt; <strong>0x7E56 ～ 0x8000</strong>，显然上面所列的节区中包含的空白区域都是足够写入扩容后的IDT信息的。这里使用节区.rdata的空白区域（<strong>0x7E56 ～ 0x8000</strong>）写入搬迁后的IDT</p>
<h4 id="构建新的-IMAGE-IMPORT-DESCRIPTOR"><a href="#构建新的-IMAGE-IMPORT-DESCRIPTOR" class="headerlink" title="构建新的_IMAGE_IMPORT_DESCRIPTOR"></a>构建新的_IMAGE_IMPORT_DESCRIPTOR</h4><p>确定写入的区域后，需要构造导入新dll的结构体_IMAGE_IMPORT_DESCRIPTOR</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_IMPORT_DESCRIPTOR</span> &#123;</span><br><span class="line">	<span class="keyword">union</span> &#123;</span><br><span class="line">		DWORD Characteristics;</span><br><span class="line">		DWORD OriginalFirstThunk;			<span class="comment">//INT(Import Name Table) address (RVA)</span></span><br><span class="line">	&#125;;</span><br><span class="line">	DWORD TimeDateStamp;</span><br><span class="line">	DWORD ForwarderChain;</span><br><span class="line">	DWORD Name;								<span class="comment">//library name string address (RVA)</span></span><br><span class="line">	DWORD FirstThunk;						<span class="comment">//IAT(Import Address Table) address (RVA)</span></span><br><span class="line">&#125; IMAGE_IMPORT_DESCRIPTOR;</span><br></pre></td></tr></table></figure>

<p>这部分是需要结合要导入的DLL源文件</p>
<p>待插入DLL – myhack3.dll源码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;windows.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;shlobj.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Wininet.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tchar.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;Wininet.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//略</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">// 出现在IDT 中的dummy export function...</span></span><br><span class="line">__declspec(dllexport) <span class="type">void</span> <span class="title function_">dummy</span><span class="params">()</span>		<span class="comment">//保证形式完整的需要</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;			</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BOOL WINAPI <span class="title function_">DllMain</span><span class="params">(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里需要了解一点关于dll文件的知识：</p>
<blockquote>
<p>__declspec是Microsoft VC中专用的关键字，它配合着一些属性可以对标准C&#x2F;C++进行扩充。__declspec关键字应该出现在声明的前面。</p>
<p>__declspec(dllexport)用于Windows中的动态库中，声明导出函数、类、对象等供外面调用，省略给出.def文件。即将函数、类等声明为导出函数，供其它程序调用，<strong>作为动态库的对外接口函数、类</strong>等。</p>
</blockquote>
<p>也就是说需要在PE文件的_IMAGE_IMPORT_DESCRIPTOR设置导入的函数为__declspec修饰的dummy函数，则会完成相应dll的载入？</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_IMPORT_DESCRIPTOR</span> &#123;</span><br><span class="line">	<span class="keyword">union</span> &#123;</span><br><span class="line">		DWORD Characteristics;</span><br><span class="line">		DWORD OriginalFirstThunk;			<span class="comment">//pointer to string dummy</span></span><br><span class="line">	&#125;;</span><br><span class="line">	DWORD TimeDateStamp;					<span class="comment">//00</span></span><br><span class="line">	DWORD ForwarderChain;					<span class="comment">//00</span></span><br><span class="line">	DWORD Name;								<span class="comment">//pointer to dll name myhack3.dll</span></span><br><span class="line">	DWORD FirstThunk;						<span class="comment">//pointer to string dummy</span></span><br><span class="line">&#125; IMAGE_IMPORT_DESCRIPTOR;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_IMPORT_BY_NAME</span> &#123;</span><br><span class="line">    WORD    Hint;	</span><br><span class="line">    BYTE    Name[<span class="number">1</span>];</span><br><span class="line">&#125; IMAGE_IMPORT_BY_NAME, *PIMAGE_IMPORT_BY_NAME;</span><br></pre></td></tr></table></figure>

<p>关于Hint成员的作用，<a target="_blank" rel="noopener" href="http://masm32.com/board/index.php?topic=6145.0">描述来源</a>：</p>
<blockquote>
<p>Hint contains the index into the export table of the DLL the function resides in. This field is for use by the PE loader so it can look up the function in the DLL’s export table quickly.<strong>This value is not essential</strong> and some linkers may set the value in this field to 0.</p>
<p>并不是必须设置的成员，但空间需要保留，设置了可以让PE装载器快速从DLL导出表中获取相关的函数信息</p>
</blockquote>
<p>关于这几个结构体的关系，在网上找到了描述得比较好的，感谢互联网：</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/7.png" class="">

<p>经过上面的分析，在空白区域写入构建结构体_IMAGE_IMPORT_DESCRIPTOR需要的内容</p>
<ul>
<li>dummy字符串（第一个字节内容需要补充hint的值，这里设置00就好）（myhack3.dll中使用关键字__declspec对其进行修饰，表明myhack3.dummy函数作为动态库myhack3.dll的对外接口函数）	写入位置</li>
<li>链接库名称myhack3.dll字符串</li>
<li><img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/8.png" class=""></li>
</ul>
<p>_IMAGE_IMPORT_DESCRIPTOR的成员都是以RVA存放的，不难理解，时PE装载器将PE文件载入内存中运行将相应地址写入完成dll函数调用的，</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_IMAGE_IMPORT_DESCRIPTOR</span> &#123;</span><br><span class="line">	<span class="keyword">union</span> &#123;</span><br><span class="line">		DWORD Characteristics;</span><br><span class="line">		DWORD OriginalFirstThunk;			<span class="comment">//0x0000FF50 -&gt; 0x00008D40(RVA)</span></span><br><span class="line">	&#125;;</span><br><span class="line">	DWORD TimeDateStamp;					<span class="comment">//0x00000000</span></span><br><span class="line">	DWORD ForwarderChain;					<span class="comment">//0x00000000</span></span><br><span class="line">	DWORD Name;								<span class="comment">//0x00007F30  -&gt; 0x00008D30(RVA)</span></span><br><span class="line">	DWORD FirstThunk;						<span class="comment">//0x0000FF50 -&gt; 0x00008D40(RVA)</span></span><br><span class="line">&#125; IMAGE_IMPORT_DESCRIPTOR;</span><br></pre></td></tr></table></figure>

<p>因此，新增的_IMAGE_IMPORT_DESCRIPTOR字节码应该是<code>408D0000 00000000 00000000 308D0000 408D0000</code></p>
<p>完成_IMAGE_IMPORT_DESCRIPTOR的构造后需要将原来IDT(0x000076CC[RAW])的内容整体搬迁，搬入节区.rdata的空白区域，这里选择的起始地址时0x00007E80（RAW）。</p>
<h4 id="写入节区的权限问题"><a href="#写入节区的权限问题" class="headerlink" title="写入节区的权限问题"></a>写入节区的权限问题</h4><p>由于意图将IDT写入节区.rdata，当PE装载器装载PE文件需要往IDT中写入实际函数的地址（由于写入的都是偏移地址，需要根据载入的ImageBase等作相应的变动）因此节区.rdata作为相关区域需要具备可写属性，也就是需要修改.rdata节区头中对节区权限的描述成员characteristic：</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/9.png" class="">

<p>当前对节区是没有写入的权限的，关于权限描述，由于比较多这里只列出需要用到的，详情查看<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-image_section_header">官方文档</a></p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Meaning</th>
</tr>
</thead>
<tbody><tr>
<td><strong>IMAGE_SCN_CNT_INITIALIZED_DATA</strong>0x00000040</td>
<td>The section contains initialized data.</td>
</tr>
<tr>
<td><strong>IMAGE_SCN_MEM_READ</strong>0x40000000</td>
<td>The section can be read.</td>
</tr>
<tr>
<td><strong>IMAGE_SCN_MEM_WRITE</strong>0x80000000</td>
<td>The section can be written to.</td>
</tr>
</tbody></table>
<p>前两个是节区.rdata自身具备的，需要在此基础上往上附加权限，由于该值是使用多个flag对应的值进行OR运算的。</p>
<p>旧权限0x40000040 &#x3D; 0x00000040 OR 0x40000000，附加上<strong>IMAGE_SCN_MEM_WRITE</strong>0x80000000 &#x3D; 0xC0000040，因此修改.rdata节区头中的characteristic &#x3D; 0xC0000040</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/10.png" class="">



<h4 id="写入新的IDT"><a href="#写入新的IDT" class="headerlink" title="写入新的IDT"></a>写入新的IDT</h4><p>接着上文分析，新增的_IMAGE_IMPORT_DESCRIPTOR字节码应该是<code>408D0000 00000000 00000000 308D0000 408D0000</code></p>
<p>完成_IMAGE_IMPORT_DESCRIPTOR的构造后需要将原来IDT(0x000076CC[RAW])的内容整体搬迁，搬入节区.rdata的空白区域，这里选择的起始地址时0x00007E80（RAW）。</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/11.png" class="">

<p>修改结束后需要修改Optionalheader.DataDirectory[1]中关于导入表的字段，新的导入表所在地址 &#x3D; RAW 0x00007E80 &#x3D; RVA 0x00008C80，导入表的SIze &#x3D; 0x00000078</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/12.png" class="">



<h4 id="特别注意"><a href="#特别注意" class="headerlink" title="特别注意"></a>特别注意</h4><p>这里需要指出的是关于<strong>BOUND IMPORT TABLE</strong> 绑定导入表是一种提高DLL加载速度的技术.对于PE文件而言<strong>是可选项, 不是必须</strong>. 当修改PE文件时, 如果添加导入的DLL文件, 需要注意有没有绑定导入表, 如果有需要删除或修改绑定导入表, 否则会运行时出错.</p>
<p>由于不是必选项，因此这里直接做null处理，绑定导入表位于Optionalheader.DataDirectory[11]</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/13.png" class="">

<p>目标文件中的绑定导入表是null因此不用管</p>
<h3 id="修改验证"><a href="#修改验证" class="headerlink" title="修改验证"></a>修改验证</h3><p>先在PE查看器中查看是否识别IDT成功</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/14.png" class="">

<p>可以看到达到预期的效果载入myhack3.dll</p>
<p>接下来运行程序，使用进程查看器，看模块myhack3.dll是否加载成功</p>
<img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/15.png" class="">

<p>可以看到dll注入成功，并且dll中的DllMain成功得到执行，由于不是内容重点，这里贴下源码即可：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;windows.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;shlobj.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Wininet.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;tchar.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">&quot;Wininet.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEF_BUF_SIZE            (4096)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEF_URL                 <span class="string">L&quot;http://www.google.com/index.html&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEF_INDEX_FILE          <span class="string">L&quot;index.html&quot;</span></span></span><br><span class="line"></span><br><span class="line">HWND g_hWnd = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">// 出现在IDT 中的dummy export function...</span></span><br><span class="line">__declspec(dllexport) <span class="function"><span class="type">void</span> <span class="title">dummy</span><span class="params">()</span>		<span class="comment">//保证形式完整的需要</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;			</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">DownloadURL</span><span class="params">(LPCTSTR szURL, LPCTSTR szFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//下载网页文件到本地</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL CALLBACK <span class="title">EnumWindowsProc</span><span class="params">(HWND hWnd, LPARAM lParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DWORD dwPID = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">GetWindowThreadProcessId</span>(hWnd, &amp;dwPID);     <span class="comment">//获取开启某个窗口或者新窗口的线程ID</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( dwPID == (DWORD)lParam )</span><br><span class="line">    &#123;</span><br><span class="line">        g_hWnd = hWnd;</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">HWND <span class="title">GetWindowHandleFromPID</span><span class="params">(DWORD dwPID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">EnumWindows</span>(EnumWindowsProc, dwPID);        <span class="comment">//将参数二传递给第一个参数中的回调函数。</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> g_hWnd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">DropFile</span><span class="params">(LPCTSTR wcsFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HWND            hWnd = <span class="literal">NULL</span>;</span><br><span class="line">    DWORD           dwBufSize = <span class="number">0</span>;</span><br><span class="line">    BYTE            *pBuf = <span class="literal">NULL</span>; </span><br><span class="line">    DROPFILES       *pDrop = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">char</span>            szFile[MAX_PATH] = &#123;<span class="number">0</span>,&#125;;</span><br><span class="line">    HANDLE          hMem = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">WideCharToMultiByte</span>(CP_ACP, <span class="number">0</span>, wcsFile, <span class="number">-1</span>,</span><br><span class="line">                        szFile, MAX_PATH, <span class="literal">NULL</span>, <span class="literal">NULL</span>);  <span class="comment">//转换字符，转换结果保存在szFile的指针对应的buf中</span></span><br><span class="line"></span><br><span class="line">    dwBufSize = <span class="built_in">sizeof</span>(DROPFILES) + <span class="built_in">strlen</span>(szFile) + <span class="number">1</span>; </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( !(hMem = <span class="built_in">GlobalAlloc</span>(GMEM_ZEROINIT, dwBufSize)) )   <span class="comment">//开辟内存</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">OutputDebugString</span>(<span class="string">L&quot;GlobalAlloc() failed!!!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pBuf = (LPBYTE)<span class="built_in">GlobalLock</span>(hMem);</span><br><span class="line"></span><br><span class="line">    pDrop = (DROPFILES*)pBuf; </span><br><span class="line">    pDrop-&gt;pFiles = <span class="built_in">sizeof</span>(DROPFILES);</span><br><span class="line">    <span class="built_in">strcpy_s</span>((<span class="type">char</span>*)(pBuf + <span class="built_in">sizeof</span>(DROPFILES)), <span class="built_in">strlen</span>(szFile)+<span class="number">1</span>, szFile);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">GlobalUnlock</span>(hMem);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( !(hWnd = <span class="built_in">GetWindowHandleFromPID</span>(<span class="built_in">GetCurrentProcessId</span>())) )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">OutputDebugString</span>(<span class="string">L&quot;GetWndHandleFromPID() failed!!!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">PostMessage</span>(hWnd, WM_DROPFILES, (WPARAM)pBuf, <span class="literal">NULL</span>);    <span class="comment">//传递内容</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">ThreadProc</span><span class="params">(LPVOID lParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TCHAR szPath[MAX_PATH] = &#123;<span class="number">0</span>,&#125;;</span><br><span class="line">    TCHAR *p = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">OutputDebugString</span>(<span class="string">L&quot;ThreadProc() start...&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">GetModuleFileName</span>(<span class="literal">NULL</span>, szPath, <span class="built_in">sizeof</span>(szPath));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( p = _tcsrchr(szPath, <span class="string">L&#x27;\\&#x27;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">        _tcscpy_s(p+<span class="number">1</span>, <span class="built_in">wcslen</span>(DEF_INDEX_FILE)+<span class="number">1</span>, DEF_INDEX_FILE);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">OutputDebugString</span>(<span class="string">L&quot;DownloadURL()&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>( <span class="built_in">DownloadURL</span>(DEF_URL, szPath) )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">OutputDebugString</span>(<span class="string">L&quot;DropFlie()&quot;</span>);</span><br><span class="line">            <span class="built_in">DropFile</span>(szPath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">OutputDebugString</span>(<span class="string">L&quot;ThreadProc() end...&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL WINAPI <span class="title">DllMain</span><span class="params">(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>( fdwReason )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> DLL_PROCESS_ATTACH : </span><br><span class="line">            <span class="built_in">CloseHandle</span>(<span class="built_in">CreateThread</span>(<span class="literal">NULL</span>, <span class="number">0</span>, ThreadProc, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>));  <span class="comment">//回到No.149处</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大致完成在宿主进程中创建新线程，在线程中调用回调函数ThreadProc，在同目录下调用DownloadURL下载文件。</p>
<h3 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h3><img src="/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/16.png" class="">

</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Victory+</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://cvjark.github.io/2022/05/05/逆核系列No-10-修改PE文件注入DLL/">https://cvjark.github.io/2022/05/05/逆核系列No-10-修改PE文件注入DLL/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E3%80%8A%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E3%80%8B/">《逆向工程核心原理学习》</a><a class="post-meta__tags" href="/tags/%E9%80%86%E5%90%91/">逆向</a></div><div class="addthis_inline_share_toolbox pull-right"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-627db6d4a04365ef" async></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/05/05/Python%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%9E%8B%E6%A6%82%E8%BF%B0/"><i class="fa fa-chevron-left">  </i><span>Python源码剖析No.2--对象模型概述</span></a></div><div class="next-post pull-right"><a href="/2022/05/04/Python%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-%E5%BC%80%E7%AF%87/"><span>Python源码剖析No.1--开篇</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://cvjark.github.io/2022/05/05/%E9%80%86%E6%A0%B8%E7%B3%BB%E5%88%97No-10-%E4%BF%AE%E6%94%B9PE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5DLL/';
  this.page.identifier = '2022/05/05/逆核系列No-10-修改PE文件注入DLL/';
  this.page.title = '逆核系列No.10--修改PE文件注入DLL';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'https-cvjark-github-io' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://https-cvjark-github-io.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://w.wallhaven.cc/full/x8/wallhaven-x8gkpo.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2022 By Victory+</div><div class="framework-info"><span>Victory+</span><span class="footer-separator">❤</span><span>TBaozi</span></div><div class="footer_custom_text"><img src="https://ghchart.rshah.org/Cvjark" alt="Cvjark Github chart" /></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>